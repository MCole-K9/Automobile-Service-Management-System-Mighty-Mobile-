import{d as I,e as V,f,U as R,K as F,o as i,c as b,a as e,t,l as c,j as o,q as S,w as L,v as q,F as D,k as B,m as g,A as E,r as U,B as T,z,b as H}from"./index.ae2c4fb3.js";import{B as y}from"./BackendService.0920bf56.js";import{_ as K}from"./DashboardLayout.3cc926e6.js";import{_ as Y}from"./plugin-vue_export-helper.21dcd24c.js";const G={class:"mx-auto my-auto"},O={class:"md:col-span-2"},Q=e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16l-4-4m0 0l4-4m-4 4h18"})],-1),W=[Q],X=e("p",{class:"text-2xl my-3 text-center font-bold"},"Job Information",-1),Z={class:"shadow-2xl overflow-hidden rounded-lg"},ee={class:c("px-4 py-5 bg-white  sm:p-6")},se={class:"grid grid-cols-6 gap-6"},te={class:"col-span-6 sm:col-span-2"},oe=e("label",{for:"full-name",class:"block text-sm font-medium text-gray-700"},"Job No.",-1),ne={class:"h-10 flex px-3 items-center bg-gray-300 rounded text-black font-medium"},ae={class:"col-span-6 sm:col-span-2"},le=e("label",{for:"service",class:"block text-sm font-medium text-gray-700"},"Service type",-1),ce={class:"h-10 flex px-3 items-center bg-gray-300 rounded text-black font-medium"},de={class:"col-span-3 sm:col-span-1"},ie=e("label",{for:"email-address",class:"block text-sm font-medium text-gray-700"},"Start Date",-1),re={class:"h-10 flex px-3 items-center rounded bg-gray-300 text-black font-medium"},me={class:"col-span-3 sm:col-span-1"},be=e("label",{for:"phone-number",class:"block text-sm font-medium text-gray-700"},"End Date",-1),ue={class:"h-10 flex px-3 items-center rounded bg-gray-300 text-black font-medium"},pe={class:"col-span-6 sm:col-span-6"},he=e("label",{for:"country",class:"block text-sm font-medium text-gray-700"},"Summary",-1),fe={class:"h-fit p-3 flex px-3 items-center bg-gray-300 rounded text-black font-medium"},_e={class:"col-span-6"},xe=e("label",{for:"street-address",class:"block text-sm font-medium text-gray-700"},"Street address",-1),ge=["value"],ye={class:"col-span-3"},ve=e("label",{for:"city",class:"block text-sm font-medium text-gray-700"},"City",-1),je=["value"],ke={class:"col-span-3"},we=e("label",{for:"region",class:"block text-sm font-medium text-gray-700"},"State / Province",-1),Ce=["value"],$e={class:"col-span-6 sm:col-span-2"},Ae=e("label",{for:"full-name",class:"block text-sm font-medium text-gray-700"},"Vehicle",-1),Me={class:"h-10 flex px-3 items-center bg-gray-300 rounded text-black font-medium"},Je={class:"col-span-6 sm:col-span-2"},Ne=e("label",{for:"email-address",class:"block text-sm font-medium text-gray-700"},"Assigned Mechanic",-1),Se=e("option",{disabled:"",selected:""},"Select Mechanic",-1),De=["value"],Be={key:0,class:"flex justify-end space-x-2 py-2"},Ue={class:"col-span-6 sm:col-span-2"},Ie=e("label",{for:"phone-number",class:"block text-sm font-medium text-gray-700"},"Created By",-1),Ve={class:"h-10 flex px-3 items-center bg-gray-300 rounded text-black font-medium"},Pe={class:"overflow-x-auto col-span-6 sm:col-span-3"},Re={class:"table w-full"},Fe=e("thead",null,[e("tr",null,[e("th",{class:"bg-gray-300"},"Name"),e("th",{class:"bg-gray-300"},"Price")])],-1),Le={class:""},qe={class:"col-span-6 sm:col-span-3 flex flex-col justify-between gap-2"},Ee=e("label",{for:"phone-number",class:"block text-sm font-medium text-gray-700"},"Service Fee",-1),Te={class:"h-10 flex px-3 items-center border border-success bg-gray-300 rounded text-black font-medium"},ze=e("label",{for:"phone-number",class:"block text-sm font-medium text-gray-700"},"Total Cost",-1),He={class:"h-10 flex px-3 items-center border border-success bg-gray-300 rounded text-black font-medium"},Ke={key:0,class:"flex flex-col justify-between bg-gray-200 px-5 my-5"},Ye={class:"flex justify-between items-center w-1/1 m-2"},Ge=e("label",{class:"font-medium"},"Confirmed by user:",-1),Oe={class:"flex justify-between items-center w-1/1 m-2"},Qe=e("label",{class:"font-medium"},"Payment",-1),We={class:"flex justify-between items-center w-1/1 m-2"},Xe=e("label",{class:"font-medium"},"Job Status",-1),Ze={key:1,class:"flex flex-col justify-between bg-gray-200 px-5 my-5"},es=e("span",{class:"flex justify-between items-center w-1/1 m-2"},[e("label",{class:"font-medium"},"Job Payment"),e("button",{class:"btn btn-success"},"pay now")],-1),ss=[es],ts=E("Set as Completed "),os=e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})],-1),ns=[ts,os],as={name:"Job"},ls=I({...as,props:{job:null},emits:["addressChange","UpdateAddress","assignmechanic"],setup(n,{emit:p}){const s=n,r=V();let j=f(r.hasRole(R.Customer)),a=f(!1);function h(u){const{name:d,value:x}=u.target;p("addressChange",d,x)}function _(){a.value=!1,p("UpdateAddress")}async function v(){s.job.completed=!0,console.log(s.job),await y.updateJob(s.job)}let k=f([]),m=f(!1);function P(){m.value&&p("assignmechanic"),m.value=!m.value}const w=f(0);return F(async()=>{if(r.isManager&&w.value<1){const u=await y.getMechanics();k.value=u==null?void 0:u.data}w.value++}),(u,d)=>{var x,C,$,A,M,J,N;return i(),b("div",G,[e("div",O,[e("button",{class:"btn btn-sm",onClick:d[0]||(d[0]=l=>u.$router.back())},W),X,e("div",Z,[e("div",ee,[e("div",se,[e("div",te,[oe,e("p",ne,t(s.job.jobNumber),1)]),e("div",ae,[le,e("p",ce,t(s.job.serviceType),1)]),e("div",de,[ie,e("p",re,t(u.$parseDate(s.job.startDate)),1)]),e("div",me,[be,e("p",ue,t(u.$parseDate(s.job.endDate)),1)]),e("div",pe,[he,e("p",fe,t(s.job.summary),1)]),e("div",_e,[xe,e("p",{class:c(`h-10 flex px-3 items-center bg-gray-300 rounded text-black font-medium ${o(a)?"hidden":""}`)},t(s.job.streetAddress),3),e("input",{onInput:h,value:s.job.streetAddress,name:"streetAddress",class:c(`input input-bordered w-full ${o(a)?"":"hidden"}`),type:"text"},null,42,ge)]),e("div",ye,[ve,e("p",{class:c(`h-10 flex px-3 items-center bg-gray-300 rounded text-black font-medium ${o(a)?"hidden":""}`)},t(s.job.town),3),e("input",{onInput:h,value:s.job.town,class:c(`input input-bordered w-full ${o(a)?"":"hidden"}`),name:"town",type:"text"},null,42,je)]),e("div",ke,[we,e("p",{class:c(`h-10 flex px-3 items-center bg-gray-300 rounded text-black font-medium ${o(a)?"hidden":""}`)},t(s.job.parish),3),e("input",{onInput:h,value:s.job.parish,class:c(`input input-bordered w-full ${o(a)?"":"hidden"}`),name:"parish",type:"text"},null,42,Ce),e("div",{class:c(`flex justify-end space-x-3 ${o(j)?"":"hidden"}`)},[e("button",{onClick:d[1]||(d[1]=(...l)=>_&&_(...l)),class:c(`btn btn-sm my-2 ${o(a)?"":"hidden"}`)},"Save",2),e("button",{onClick:d[2]||(d[2]=l=>S(a)?a.value=!o(a):a=!o(a)),class:"btn btn-sm my-2"},t(o(a)?"Disable":"Edit Address"),1)],2)]),e("div",$e,[Ae,e("p",Me,t((x=s.job.vehicle)==null?void 0:x.year)+" "+t((C=s.job.vehicle)==null?void 0:C.make)+" "+t(($=s.job.vehicle)==null?void 0:$.model),1)]),e("div",Je,[Ne,e("p",{class:c(`h-10 flex px-3 items-center bg-gray-300 rounded text-black font-medium ${o(m)?"hidden":""}`)},t(s.job.assignedMechanic?`${(A=s.job.assignedMechanic)==null?void 0:A.firstName}
                                ${(M=s.job.assignedMechanic)==null?void 0:M.lastName}`:"Unassigned"),3),L(e("select",{"onUpdate:modelValue":d[3]||(d[3]=l=>s.job.assignedMechanicId=l),class:c(`select select-bordered w-full ${o(m)?"":"hidden"} `),id:"selectCustomer"},[Se,(i(!0),b(D,null,B(o(k),l=>(i(),b("option",{key:l.id,value:l.id},t(l.firstName)+" "+t(l.lastName),9,De))),128))],2),[[q,s.job.assignedMechanicId]]),o(r).isManager?(i(),b("div",Be,[e("button",{onClick:P,class:"btn btn-sm"},t(o(m)?"Save":"Assign Mechanic"),1),o(m)?(i(),b("button",{key:0,onClick:d[4]||(d[4]=l=>S(m)?m.value=!1:m=!1),class:"btn btn-sm"},"Cancel")):g("",!0)])):g("",!0)]),e("div",Ue,[Ie,e("p",Ve,t((J=s.job.createdBy)==null?void 0:J.firstName)+" "+t((N=s.job.createdBy)==null?void 0:N.lastName),1)]),e("div",Pe,[e("table",Re,[Fe,e("tbody",Le,[(i(!0),b(D,null,B(s.job.requiredParts,l=>(i(),b("tr",{key:l.id},[e("td",null,t(l.name),1),e("td",null,"$"+t(l.price),1)]))),128))])])]),e("div",qe,[Ee,e("p",Te," $"+t(s.job.serviceFee),1),ze,e("p",He," $"+t(s.job.totalCost),1),o(r).isAdmin||o(r).isManager||o(r).isMechanic?(i(),b("span",Ke,[e("span",Ye,[Ge,e("p",{class:c(`h-10 px-3 flex rounded self-center items-center max-w-fit ${s.job.confirmed?"bg-success":"bg-error"}`)},t(s.job.confirmed?"Yes":"No"),3)]),e("span",Oe,[Qe,e("p",{class:c(`h-10 px-3 flex rounded self-center items-center max-w-fit ${s.job.isPaid?"bg-success":"bg-error"}`)},t(s.job.isPaid?"Made":"Not made"),3)]),e("span",We,[Xe,e("p",{class:c(`h-10 px-3 flex rounded self-center items-center max-w-fit ${s.job.completed?"bg-success":"bg-error"}`)},t(s.job.completed?"Completed":"Not yet done"),3)])])):s.job.confirmed?(i(),b("span",Ze,ss)):g("",!0),!s.job.completed&&s.job.confirmed&&(o(r).isAdmin||o(r).isManager||o(r).isMechanic)?(i(),b("button",{key:2,class:"btn btn-success max-w-xs self-center",onClick:v},ns)):g("",!0)])])])])])])}}}),cs=V(),ds=I({name:"JobDetailsView",components:{JobInformation:ls,DashboardLayout:K},data(){return{jobNumber:0,job:{},isCustomer:cs.isCustomer}},methods:{handleAddressChange(n,p){this.job={...this.job,[n]:p}},async updateJob(){const n=await y.updateJob(this.job);this.job=n==null?void 0:n.data,console.log(n)},async acceptJob(){this.job.confirmed=!0,this.updateJob()}},async mounted(){this.jobNumber=Number.parseInt(this.$route.params.id);const n=await y.getJob(this.jobNumber);this.job={...n==null?void 0:n.data}}}),is={class:"flex justify-center space-x-3"};function rs(n,p,s,r,j,a){const h=U("JobInformation"),_=U("DashboardLayout");return i(),T(_,null,{content:z(()=>[e("section",is,[e("button",{onClick:p[0]||(p[0]=(...v)=>n.acceptJob&&n.acceptJob(...v)),class:c(`btn btn-sm ${n.isCustomer&&!n.job.confirmed?"":"hidden"} `)},"Accept Request",2)]),H(h,{onAddressChange:n.handleAddressChange,onUpdateAddress:n.updateJob,onAssignmechanic:n.updateJob,job:n.job},null,8,["onAddressChange","onUpdateAddress","onAssignmechanic","job"])]),_:1})}var hs=Y(ds,[["render",rs]]);export{hs as default};
