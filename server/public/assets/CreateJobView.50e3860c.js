import{d as L,u as O,L as Z,e as z,f,h as m,g as H,i as Y,o as n,B as K,z as Q,a as e,j as l,c as d,w as v,v as C,q as V,F as M,k as E,t as c,l as _,m as b,p as w}from"./index.8442f19d.js";import{_ as F}from"./DashboardLayout.8c5994ed.js";import{B as N}from"./BackendService.cf86a9fe.js";import{V as x}from"./Validation.efea6428.js";const W={id:"customer_info"},X=e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16l-4-4m0 0l4-4m-4 4h18"})],-1),ee=[X],te=e("p",{class:"text-2xl lg:text-4xl mb-5 text-center font-bold"},"Create Job",-1),se={class:"grid grid-cols-1 sm:grid-cols-4 gap-6 text-center"},le={key:0,class:"mx-auto flex flex-col space-y-4 w-full"},oe=e("label",{class:"text-center w-full py-4 px-2 bg-ourGrey shadow-lg"},"Customer Name",-1),ae=e("option",{disabled:"",selected:""},"Select Customer",-1),re=["value"],ne={key:1,class:"mx-auto flex flex-col space-y-4 w-full"},ie=e("label",{class:"text-center w-full py-4 px-2 bg-ourGrey shadow-lg"},"Customer Name",-1),de=["value"],ue={class:"mx-auto flex flex-col space-y-4 w-full"},ce=e("label",{class:"text-center w-full py-4 px-2 bg-ourGrey shadow-lg"},"Mobile Number",-1),pe=["value"],me={class:"mx-auto flex flex-col space-y-4 w-full"},ve=e("label",{class:"text-center w-full py-4 px-2 bg-ourGrey shadow-lg"},"Email Address",-1),xe=["value"],_e={key:2,class:"mx-auto flex flex-col space-y-4 w-full"},fe=e("label",{class:"text-center w-full py-4 px-2 bg-ourGrey shadow-lg"},"Vehicle",-1),be=["disabled"],he=e("option",{disabled:"",selected:""},"Select Vehicle",-1),ye=["value"],we={key:3,class:"mx-auto flex flex-col space-y-4 w-full"},ge=e("label",{class:"text-center w-full py-4 px-2 bg-ourGrey shadow-lg"},"Vehicle",-1),ke=["value"],Ce={id:"job_info",class:"mt-10"},De={class:"grid grid-cols-1 sm:grid-cols-3 gap-6 text-center"},Ve={class:"mx-auto flex flex-col space-y-4 w-full"},Ne=e("label",{class:"text-center w-full py-4 px-2 bg-ourGrey shadow-lg"},"Service Type",-1),Me=e("option",{disabled:"",selected:""},"Select type",-1),Ee=e("option",{value:"Repair"},"Repair",-1),Pe=e("option",{value:"Maintenance"},"Maintenance",-1),Se=[Me,Ee,Pe],qe={class:"mx-auto flex flex-col space-y-4 w-full"},Ge=e("label",{class:"text-center w-full py-4 px-2 bg-ourGrey shadow-lg"},"Start Date",-1),Ue={class:"mx-auto flex flex-col space-y-4 w-full"},Fe=e("label",{class:"text-center w-full py-4 px-2 bg-ourGrey shadow-lg"},"End Date",-1),$e={class:"flex w-full space-x-2 items-center"},je={class:"mt-10"},Re={class:"grid grid-cols-1 sm:grid-cols-3 gap-6 text-center"},Te={class:"mx-auto flex flex-col space-y-4 w-full"},Be=e("label",{class:"text-center w-full py-4 px-2 bg-ourGrey shadow-lg"},"Service Fee",-1),Ie={class:"input-group w-full"},Ae=e("span",null,"$",-1),Je={class:"mx-auto flex flex-col space-y-4 w-full sm:col-span-2"},Le=e("label",{class:"text-center w-full py-4 px-2 bg-ourGrey shadow-lg"},"Parts Needed",-1),Oe={class:"flex space-x-3"},Ze={class:"input-group w-full"},ze=e("span",null,"$",-1),He={class:"flex justify-end space-x-3"},Ye={id:"summery",class:"mt-5"},Ke={class:"grid grid-cols-1 text-center"},Qe={class:"mx-auto flex flex-col space-y-4 w-full"},We=e("label",{class:"text-center w-full py-4 px-2 bg-ourGrey shadow-lg"},"Summery",-1),Xe=e("input",{type:"checkbox",id:"my-modal-4",class:"modal-toggle"},null,-1),et={class:"modal"},tt={class:"modal-box relative"},st=e("label",{for:"my-modal-4",class:"btn btn-sm btn-circle absolute right-2 top-2"},"\u2715",-1),lt=e("h3",{class:"text-lg font-bold text-center"},"Job Parts",-1),ot={class:"flex flex-col space-y-3 mt-4"},at=["onClick"],rt=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),nt=[rt],it={name:"CreateJobView",components:{DashboardLayout:F}},_t=L({...it,setup(dt){var S;const $=O(),h=Z().params.id;h?j():console.log("No ID");async function j(){let r=await N.getAppointment(Number(h)),t=r==null?void 0:r.data;i.value=t.customer,u.value=t.vehicle}let R=z(),P=f([]),i=f({id:0,email:"",firstName:"",lastName:""}),u=f(),o=f({jobNumber:0,endDate:new Date,serviceFee:0,serviceType:"",startDate:new Date,summary:"",vehicleId:(S=u.value)==null?void 0:S.id,requiredParts:[]});const y=f(""),g=f("");let p=f({name:"",price:0}),T=m(()=>{var t;let r=0;return(t=o.value.requiredParts)==null||t.forEach(k=>{r+=k.price}),o.value.serviceFee+r});function B(){var r;a.part.valid&&((r=o.value.requiredParts)==null||r.push({...p.value}),p.value.name="",p.value.price=0)}function I(r){var t;o.value.requiredParts=(t=o.value.requiredParts)==null?void 0:t.filter((k,D)=>D!=r)}const a=H({customer:m(()=>i.value.id>0),vehicle:m(()=>{var r;return((r=u.value)==null?void 0:r.id)>0}),serviceType:m(()=>!x.isEmpty(o.value.serviceType)),serviceFee:m(()=>!x.isZeroOrNegative(o.value.serviceFee)),startDate:m(()=>x.dateGteToday(y.value)),endDate:m(()=>x.dateGte(y.value,g.value)),part:{valid:m(()=>!x.isEmpty(p.value.name)&&!x.isZeroOrNegative(p.value.price)),name:m(()=>!x.isEmpty(p.value.name)),price:m(()=>!x.isZeroOrNegative(p.value.price))},summary:m(()=>!x.isEmpty(o.value.summary)),showErrorMsg:!1});function A(){return a.customer&&a.vehicle&&a.summary&&a.serviceFee&&a.serviceType&&a.startDate&&a.endDate}async function J(){var r;if(A()){o.value.createdById=R.User.id,o.value.vehicleId=(r=u.value)==null?void 0:r.id,o.value.totalCost=T.value,o.value.startDate=new Date(y.value),o.value.endDate=new Date(g.value);const t=await N.createJob(o.value);(t==null?void 0:t.status)&&(t==null?void 0:t.status)<300&&$.push({name:"jobboard"}),h&&await N.fulfillAppointment(Number(h))}else a.showErrorMsg=!0}return Y(async()=>{const r=await N.getCustomers();P.value=[...r==null?void 0:r.data],console.log()}),(r,t)=>(n(),K(F,null,{content:Q(()=>{var k,D,q,G;return[e("section",W,[e("button",{class:"btn btn-sm max-w-fit",onClick:t[0]||(t[0]=s=>r.$router.back())},ee),te,e("div",se,[l(h)?(n(),d("div",ne,[ie,v(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>V(i)?i.value=s:i=s),class:"select select-bordered w-full",id:"selectCustomer",disabled:""},[e("option",{disabled:"",selected:"",value:l(i)},c(l(i).firstName)+" "+c(l(i).lastName),9,de)],512),[[C,l(i)]])])):(n(),d("div",le,[oe,v(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>V(i)?i.value=s:i=s),class:"select select-bordered w-full",id:"selectCustomer"},[ae,(n(!0),d(M,null,E(l(P),s=>(n(),d("option",{key:s.id,value:s},c(s.firstName)+" "+c(s.lastName),9,re))),128))],512),[[C,l(i)]]),a.showErrorMsg?(n(),d("span",{key:0,class:_(`text-xs text-red-400 px-2 ${a.customer?"hidden":"block"}`)},"Customer Is Required",2)):b("",!0)])),e("div",ue,[ce,e("input",{class:"input w-full input-bordered",type:"text",value:l(i).phoneNumber,disabled:""},null,8,pe)]),e("div",me,[ve,e("input",{class:"input w-full input-bordered",type:"email",value:l(i).email,disabled:""},null,8,xe)]),l(h)?(n(),d("div",we,[ge,v(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>V(u)?u.value=s:u=s),class:"select select-bordered w-full",id:"selectCustomer",disabled:""},[e("option",{disabled:"",selected:"",value:l(u)},c((k=l(u))==null?void 0:k.year)+" "+c((D=l(u))==null?void 0:D.make)+" "+c((q=l(u))==null?void 0:q.model),9,ke)],512),[[C,l(u)]])])):(n(),d("div",_e,[fe,v(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>V(u)?u.value=s:u=s),disabled:l(i).id===0,class:"select select-bordered w-full",id:"firstNoticed"},[he,(n(!0),d(M,null,E(l(i).vehicles,s=>(n(),d("option",{key:s.id,value:s},c(s.year)+" "+c(s.make)+" "+c(s.model),9,ye))),128))],8,be),[[C,l(u)]]),a.showErrorMsg?(n(),d("span",{key:0,class:_(`text-xs text-red-400 px-2 ${a.vehicle?"hidden":"block"}`)},"Vehicle Is Required",2)):b("",!0)]))])]),e("section",Ce,[e("div",De,[e("div",Ve,[Ne,v(e("select",{"onUpdate:modelValue":t[5]||(t[5]=s=>l(o).serviceType=s),class:"select select-bordered w-full"},Se,512),[[C,l(o).serviceType]]),a.showErrorMsg?(n(),d("span",{key:0,class:_(`text-xs text-red-400 px-2 ${a.serviceType?"hidden":"block"}`)},"Service Type Is Required",2)):b("",!0)]),e("div",qe,[Ge,v(e("input",{class:"input input-bordered",type:"date","onUpdate:modelValue":t[6]||(t[6]=s=>y.value=s)},null,512),[[w,y.value]]),a.showErrorMsg?(n(),d("span",{key:0,class:_(`text-xs text-red-400 px-2 ${a.startDate?"hidden":"block"}`)},"Invalid Date",2)):b("",!0)]),e("div",Ue,[Fe,e("div",$e,[v(e("input",{class:"input input-bordered w-full flex-grow-1",type:"date","onUpdate:modelValue":t[7]||(t[7]=s=>g.value=s)},null,512),[[w,g.value]]),e("button",{class:"btn btn-sm",onClick:t[8]||(t[8]=s=>g.value=y.value)},"Same Day")]),a.showErrorMsg?(n(),d("span",{key:0,class:_(`text-xs text-red-400 px-2 ${a.endDate?"hidden":"block"}`)},"Invalid Date",2)):b("",!0)])])]),e("section",je,[e("div",Re,[e("div",Te,[Be,e("label",Ie,[Ae,v(e("input",{type:"number",class:"input input-bordered w-full","onUpdate:modelValue":t[9]||(t[9]=s=>l(o).serviceFee=s)},null,512),[[w,l(o).serviceFee]])]),a.showErrorMsg?(n(),d("span",{key:0,class:_(`text-xs text-red-400 px-2 ${a.serviceFee?"hidden":"block"}`)},"Service Fee Required",2)):b("",!0)]),e("div",Je,[Le,e("div",Oe,[v(e("input",{type:"text",class:"input input-bordered w-full",placeholder:"Name","onUpdate:modelValue":t[10]||(t[10]=s=>l(p).name=s)},null,512),[[w,l(p).name]]),e("label",Ze,[ze,v(e("input",{type:"number",class:"input input-bordered w-full",placeholder:"Cost","onUpdate:modelValue":t[11]||(t[11]=s=>l(p).price=s)},null,512),[[w,l(p).price]])])]),e("div",He,[e("label",{for:"my-modal-4",class:_(`btn btn-sm modal-button ${l(o).requiredParts&&((G=l(o).requiredParts)==null?void 0:G.length)>0?"":"hidden"}`)},"Preview Parts",2),e("button",{class:"btn btn-sm",onClick:t[12]||(t[12]=s=>B())},"Add Part +")])])])]),e("section",Ye,[e("div",Ke,[e("div",Qe,[We,v(e("textarea",{rows:"8",class:"textarea textarea-bordered",placeholder:"Summery","onUpdate:modelValue":t[13]||(t[13]=s=>l(o).summary=s)},null,512),[[w,l(o).summary]]),a.showErrorMsg?(n(),d("span",{key:0,class:_(`text-xs text-red-400 px-2 ${a.summary?"hidden":"block"}`)},"Summery is Required",2)):b("",!0)])])]),e("div",{class:"flex justify-center mt-4"},[e("button",{onClick:J,class:"btn btn-sm px-8 bg-ourYellow"},"Create")]),Xe,e("div",et,[e("div",tt,[st,lt,e("ul",ot,[(n(!0),d(M,null,E(l(o).requiredParts,(s,U)=>(n(),d("li",{key:U,class:"flex justify-between items-center"},[e("span",null,c(s.name),1),e("span",null,"$"+c(s.price),1),e("span",{class:"btn btn-ghost cursor-pointer",onClick:ct=>I(U)},nt,8,at)]))),128))])])])]}),_:1}))}});export{_t as default};
